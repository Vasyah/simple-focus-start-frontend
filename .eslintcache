[{"C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\index.js":"1","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\App.js":"2","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\contexts\\AuthContext.js":"3","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\components\\Header\\Header.js":"4","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\components\\PrivateRoute\\PrivateRoute.js":"5","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\firebase.js":"6","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\components\\Alert\\Alert.js":"7","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\hooks\\useValidatePassword.js":"8","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\hooks\\useLogin.js":"9","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\hooks\\useValidateEmail.js":"10","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\hooks\\useSignup.js":"11","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\hooks\\useUpdateProfile.js":"12","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\hooks\\useForgotPassword.js":"13","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\components\\Users\\Users.js":"14","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\components\\Loading\\Loading.js":"15","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\components\\Delayed\\Delayed.js":"16","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\hooks\\useNoUser.js":"17","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\contexts\\VideoContext.js":"18","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\contexts\\MessagesContext.js":"19","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\contexts\\GlobalPopupContext.js":"20","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\components\\GlobalPopup\\GlobalPopup.js":"21","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\components\\StartListenServer\\StartListenServer.js":"22","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\pages\\UpdateProfilePage\\UpdateProfilePage.js":"23","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\pages\\ChatPage\\ChatPage.js":"24","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\pages\\VideoChatPage\\VideoChatPage.js":"25","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\pages\\ForgotPasswordPage\\ForgotPasswordPage.js":"26","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\pages\\NewsPage\\NewsPage.js":"27","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\pages\\LoginPage\\LoginPage.js":"28","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\pages\\SignupPage\\SignupPage.js":"29","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\components\\AudioMessage\\AudioMessage.js":"30","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\contexts\\ThemeContext.js":"31","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\components\\SwitchTheme\\SwitchTheme.js":"32"},{"size":319,"mtime":1612118605281,"results":"33","hashOfConfig":"34"},{"size":2830,"mtime":1612173967996,"results":"35","hashOfConfig":"34"},{"size":7049,"mtime":1612156335996,"results":"36","hashOfConfig":"34"},{"size":3267,"mtime":1612169946633,"results":"37","hashOfConfig":"34"},{"size":969,"mtime":1611836140736,"results":"38","hashOfConfig":"34"},{"size":576,"mtime":1610813206689,"results":"39","hashOfConfig":"34"},{"size":388,"mtime":1609957114998,"results":"40","hashOfConfig":"34"},{"size":992,"mtime":1610045519359,"results":"41","hashOfConfig":"34"},{"size":902,"mtime":1611241623709,"results":"42","hashOfConfig":"34"},{"size":794,"mtime":1610045509732,"results":"43","hashOfConfig":"34"},{"size":930,"mtime":1611241540320,"results":"44","hashOfConfig":"34"},{"size":1255,"mtime":1610045493394,"results":"45","hashOfConfig":"34"},{"size":1134,"mtime":1610897175500,"results":"46","hashOfConfig":"34"},{"size":565,"mtime":1612150995856,"results":"47","hashOfConfig":"34"},{"size":323,"mtime":1612170203922,"results":"48","hashOfConfig":"34"},{"size":343,"mtime":1611135810167,"results":"49","hashOfConfig":"34"},{"size":550,"mtime":1611047095621,"results":"50","hashOfConfig":"34"},{"size":4131,"mtime":1612032300252,"results":"51","hashOfConfig":"34"},{"size":7538,"mtime":1612168136708,"results":"52","hashOfConfig":"34"},{"size":784,"mtime":1612019162620,"results":"53","hashOfConfig":"34"},{"size":2413,"mtime":1612174920796,"results":"54","hashOfConfig":"34"},{"size":625,"mtime":1611836380627,"results":"55","hashOfConfig":"34"},{"size":3915,"mtime":1612025384512,"results":"56","hashOfConfig":"34"},{"size":5666,"mtime":1612173946365,"results":"57","hashOfConfig":"34"},{"size":3750,"mtime":1612174118906,"results":"58","hashOfConfig":"34"},{"size":2733,"mtime":1612025343148,"results":"59","hashOfConfig":"34"},{"size":212,"mtime":1611925473448,"results":"60","hashOfConfig":"34"},{"size":3206,"mtime":1612025357649,"results":"61","hashOfConfig":"34"},{"size":4249,"mtime":1612025369378,"results":"62","hashOfConfig":"34"},{"size":1596,"mtime":1612032002329,"results":"63","hashOfConfig":"34"},{"size":1445,"mtime":1612170077143,"results":"64","hashOfConfig":"34"},{"size":647,"mtime":1612170108228,"results":"65","hashOfConfig":"34"},{"filePath":"66","messages":"67","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},"146o5a3",{"filePath":"69","messages":"70","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"71","messages":"72","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"73","messages":"74","errorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"75","usedDeprecatedRules":"68"},{"filePath":"76","messages":"77","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"78","messages":"79","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"80","messages":"81","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"82","messages":"83","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"84","messages":"85","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"86","messages":"87","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"88","messages":"89","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"90","messages":"91","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"92","messages":"93","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"94","messages":"95","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"96","messages":"97","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"98","messages":"99","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"100","messages":"101","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"102","usedDeprecatedRules":"103"},{"filePath":"104","messages":"105","errorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"106","usedDeprecatedRules":"68"},{"filePath":"107","messages":"108","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"109","usedDeprecatedRules":"68"},{"filePath":"110","messages":"111","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"112","messages":"113","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"114","messages":"115","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"116","usedDeprecatedRules":"68"},{"filePath":"117","messages":"118","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"119","messages":"120","errorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},{"filePath":"121","messages":"122","errorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},{"filePath":"123","messages":"124","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"125","messages":"126","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"127","messages":"128","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"129","messages":"130","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"131","messages":"132","errorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"133","usedDeprecatedRules":"134"},{"filePath":"135","messages":"136","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"137","messages":"138","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},"C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\index.js",[],["139","140"],"C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\App.js",[],"C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\contexts\\AuthContext.js",[],"C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\components\\Header\\Header.js",["141","142","143","144"],"import React, { useState, useEffect, useMemo, useRef } from \"react\";\r\nimport './header.scss';\r\nimport Alert from \"../Alert/Alert\";\r\nimport { Link, useHistory } from \"react-router-dom\";\r\nimport { useAuth } from \"../../contexts/AuthContext\";\r\nimport logo from '../../assets/logo/logo-transparent-cut.png';\r\nimport { useTheme } from \"../../contexts/ThemeContext\";\r\nimport SwitchTheme from \"../SwitchTheme/SwitchTheme\";\r\n\r\nconst Header = () => {\r\n  // ref\r\n  const dropdownRef = useRef();\r\n  // state\r\n  const [ errors, setErrors ] = useState([]);\r\n  const [ isProfileMenuOpened, setIsProfileMenuOpened ] = useState(false);\r\n  // other\r\n  const history = useHistory();\r\n  const { currentUser, allUsers, logout } = useAuth();\r\n\r\n  const handleUpdate = () => {\r\n    history.push('/update-profile');\r\n  }\r\n\r\n  const handleLogout = async () => {\r\n    setErrors([]);\r\n    try {\r\n      await logout();\r\n      history.push('/login');\r\n    } catch (error) {\r\n      console.error('logout error', error);\r\n      // setErrors([ 'Не удалось выйти из аккаунта!' ]);\r\n    }\r\n  }\r\n\r\n  const handleClickOutside = (event) => !event.composedPath().includes(dropdownRef.current) && setIsProfileMenuOpened(false);\r\n  const handleClickOutsideMemo = useMemo(() => handleClickOutside, []);\r\n\r\n  useEffect(() => {\r\n    isProfileMenuOpened\r\n      ? window.addEventListener('click', handleClickOutsideMemo, false)\r\n      : window.removeEventListener('click', handleClickOutsideMemo, false);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [ isProfileMenuOpened ]);\r\n\r\n  return (\r\n    <div className={'header-wrapper'}>\r\n      <div className={'header-content container'}>\r\n        <Link to={'/'} className=\"logo active\">\r\n          <img className={'logo-img'} src={logo} alt=\"logo\"/>\r\n        </Link>\r\n        <div className=\"navigation\">\r\n\r\n        </div>\r\n        {\r\n          !currentUser\r\n            // if no user show only theme switch\r\n            ? <SwitchTheme/>\r\n            // if user show all menu\r\n            : <div className=\"profile-dropdown-menu-wrapper\" ref={dropdownRef}>\r\n              <div className=\"profile-dropdown-menu hover-bg\"\r\n                   onClick={() => setIsProfileMenuOpened(!isProfileMenuOpened)}>\r\n                <div className=\"profile-left\">\r\n                  <h3 className=\"profile-name\">{currentUser.name}</h3>\r\n                </div>\r\n                <div className=\"profile-right\">\r\n                  <div className=\"profile-avatar\">{currentUser.name.substr(0, 1)}</div>\r\n                  <div className=\"profile-arrow\"/>\r\n                </div>\r\n              </div>\r\n              {isProfileMenuOpened &&\r\n              <div className=\"profile-dropdown-item\">\r\n                <SwitchTheme/>\r\n                <div className={'update-profile-wrapper'}>\r\n                  <button className={'update-profile-button'} onClick={handleUpdate}>Изменить профиль</button>\r\n                </div>\r\n                <div className={'logout-button-wrapper'}>\r\n                  <button className={'logout-button'} onClick={handleLogout}>Выйти</button>\r\n                </div>\r\n              </div>\r\n              }\r\n            </div>}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Header;\r\n","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\components\\PrivateRoute\\PrivateRoute.js",[],"C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\firebase.js",[],"C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\components\\Alert\\Alert.js",[],"C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\hooks\\useValidatePassword.js",[],"C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\hooks\\useLogin.js",[],"C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\hooks\\useValidateEmail.js",[],"C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\hooks\\useSignup.js",[],"C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\hooks\\useUpdateProfile.js",[],"C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\hooks\\useForgotPassword.js",[],"C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\components\\Users\\Users.js",[],"C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\components\\Loading\\Loading.js",[],"C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\components\\Delayed\\Delayed.js",[],"C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\hooks\\useNoUser.js",["145"],"import { useState, useEffect } from 'react';\r\nimport { useAuth } from \"../contexts/AuthContext\";\r\n\r\nconst useNoUser = () => {\r\n  const [ noUser, setNoUser ] = useState(true);\r\n  const { currentUser } = useAuth();\r\n\r\n  useEffect(() => {\r\n    fetchUser().then(() => {\r\n      console.log(currentUser)\r\n    });\r\n  }, [ currentUser ]);\r\n\r\n  const fetchUser = async () => {\r\n    try {\r\n      !currentUser ? setNoUser(true) : setNoUser(false);\r\n    } catch {\r\n      console.log('error');\r\n    }\r\n  }\r\n\r\n  return { noUser };\r\n}\r\n\r\nexport default useNoUser;\r\n",["146","147"],"C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\contexts\\VideoContext.js",["148","149","150"],"import React, { useContext, useEffect, useState } from 'react';\r\nimport firebase from 'firebase';\r\nimport { useAuth } from \"./AuthContext\";\r\nimport io from \"socket.io-client\";\r\nimport Peer from \"simple-peer\";\r\n\r\nconst VideoContext = React.createContext(undefined, undefined);\r\n\r\nexport const useVideo = () => useContext(VideoContext);\r\n\r\nexport function VideoProvider({ children }) {\r\n  // state\r\n  const [ stream, setStream ] = useState();\r\n  const [ receivingCall, setReceivingCall ] = useState(false);\r\n  const [ caller, setCaller ] = useState(\"\");\r\n  const [ callerSignal, setCallerSignal ] = useState();\r\n  const [ callAccepted, setCallAccepted ] = useState(false);\r\n  const [ loading, setLoading ] = useState(false);\r\n  const [ socket, setSocket ] = useState();\r\n  // other\r\n  const { currentUser } = useAuth();\r\n\r\n  const stopCurrentUserVideo = (userVideo) => {\r\n    if (userVideo && userVideo.srcObject) {\r\n      const tracks = userVideo.srcObject.getTracks();\r\n      tracks.forEach(track => {\r\n        track.stop();\r\n      });\r\n      userVideo.srcObject = null;\r\n    }\r\n  }\r\n\r\n  const stopOtherUserVideo = (partnerVideo) => {\r\n    if (partnerVideo && partnerVideo.srcObject) {\r\n      const tracks = partnerVideo.srcObject.getTracks();\r\n      tracks.forEach(track => {\r\n        track.stop();\r\n      });\r\n      partnerVideo.srcObject = null;\r\n    }\r\n  }\r\n\r\n  const stopCall = (userVideo, partnerVideo) => {\r\n    stopCurrentUserVideo(userVideo);\r\n    stopOtherUserVideo(partnerVideo);\r\n    declineCall();\r\n  }\r\n\r\n  const declineCall = () => {\r\n    setCallAccepted(false);\r\n    setReceivingCall(false);\r\n  }\r\n\r\n  const startListen = () => {\r\n    // сюда мб\r\n    const socket = io.connect(\"/\");\r\n    if (currentUser) {\r\n      socket.emit(\"yourID\", currentUser.id);\r\n      socket.emit(\"allUsers\", currentUser.id);\r\n\r\n      socket.on(\"hey\", (data) => {\r\n        setReceivingCall(true);\r\n        setCaller({ from: data.from, data });\r\n        setCallerSignal(data.signal);\r\n      })\r\n    }\r\n\r\n    setSocket(socket);\r\n  }\r\n\r\n  const startVideo = (userVideo) => {\r\n    if (currentUser) {\r\n      navigator.mediaDevices.getUserMedia({ video: true, audio: false }).then(stream => {\r\n        setStream(stream);\r\n        if (userVideo.current) {\r\n          userVideo.current.srcObject = stream;\r\n        }\r\n\r\n        if (socket) {\r\n          socket.on(\"hey\", (data) => {\r\n            setReceivingCall(true);\r\n            setCaller({ from: data.from, data });\r\n            setCallerSignal(data.signal);\r\n          })\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  const callPeer = (id, partnerVideo) => {\r\n    console.log('срабатывает у того кто звонит');\r\n    const peer = new Peer({\r\n      initiator: true,\r\n      trickle: false,\r\n      stream: stream,\r\n    });\r\n\r\n    peer.on('signal', data => {\r\n      socket.emit('callUser', {\r\n        userToCall: id,\r\n        signalData: data,\r\n        from: currentUser.id,\r\n      })\r\n    })\r\n\r\n    peer.on(\"stream\", stream => {\r\n      if (partnerVideo.current) {\r\n        partnerVideo.current.srcObject = stream;\r\n      }\r\n    });\r\n\r\n    socket.on(\"callAccepted\", signal => {\r\n      setCallAccepted(true);\r\n      peer.signal(signal);\r\n    })\r\n\r\n  }\r\n\r\n  const acceptCall = (partnerVideo) => {\r\n    console.log('срабатывает у того кому звонят')\r\n    setCallAccepted(true);\r\n    const peer = new Peer({\r\n      initiator: false,\r\n      trickle: false,\r\n      stream: stream,\r\n    });\r\n\r\n    peer.on('signal', data => {\r\n      socket.emit('acceptCall', {\r\n        signal: data,\r\n        to: caller.from\r\n      })\r\n    })\r\n\r\n    peer.on(\"stream\", stream => {\r\n      partnerVideo.current.srcObject = stream;\r\n    });\r\n\r\n    peer.signal(callerSignal);\r\n  }\r\n\r\n  const value = {\r\n    // state\r\n    receivingCall,\r\n    callAccepted,\r\n    stream,\r\n    caller,\r\n    // actions\r\n    stopCurrentUserVideo,\r\n    stopOtherUserVideo,\r\n    stopCall,\r\n    startVideo,\r\n    callPeer,\r\n    acceptCall,\r\n    declineCall,\r\n    startListen\r\n  }\r\n\r\n  return (\r\n    <VideoContext.Provider value={value}>\r\n      {!loading && children}\r\n    </VideoContext.Provider>\r\n  )\r\n}\r\n","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\contexts\\MessagesContext.js",["151"],"import React, { useContext, useEffect, useState } from 'react';\r\nimport firebase from 'firebase';\r\nimport { useAuth } from \"./AuthContext\";\r\nimport MicRecorder from 'mic-recorder-to-mp3';\r\nimport uniqId from \"uniqid\";\r\n\r\nconst Mp3Recorder = new MicRecorder({ bitRate: 128 });\r\n\r\nconst MessagesContext = React.createContext(undefined, undefined);\r\n\r\nexport const useMessages = () => useContext(MessagesContext);\r\n\r\nlet messagesRef;\r\n\r\nexport function MessagesProvider({ children }) {\r\n  // state\r\n  const [ messages, setMessages ] = useState([]);\r\n  const [ isRecording, setIsRecording ] = useState(false);\r\n  const [ isBlocked, setIsBlocked ] = useState(false);\r\n  // other\r\n  const { currentUser } = useAuth();\r\n\r\n  // voice messages\r\n\r\n  const start = () => {\r\n    // start recording voice\r\n    if (isBlocked) {\r\n      console.log('Permission Denied');\r\n    } else {\r\n      Mp3Recorder\r\n        .start()\r\n        .then(() => {\r\n          setIsRecording(true)\r\n        })\r\n        .catch((e) => console.error(e));\r\n    }\r\n  };\r\n\r\n  const stop = (message, showVoiceRecorder, otherUserId) => {\r\n    // stop recording voice\r\n    Mp3Recorder\r\n      .stop()\r\n      .getMp3()\r\n      .then(([ buffer, blob ]) => {\r\n        setIsRecording(false);\r\n        // set voice file\r\n        const file = new File(buffer, 'music.mp3', {\r\n          type: blob.type,\r\n          lastModified: Date.now()\r\n        });\r\n        console.log('player', URL.createObjectURL(file));\r\n\r\n        const uniqIdSaved = uniqId();\r\n        // save voice file in another db\r\n        firebase.storage()\r\n          .ref(`chats/${currentUser.id}/${otherUserId}/${uniqIdSaved}`)\r\n          .put(file)\r\n          .then(snapshot => {\r\n            console.log(snapshot);\r\n            sendMessageHandler({ message, showVoiceRecorder, otherUserId, uniqId: uniqIdSaved });\r\n          });\r\n      })\r\n      .catch((error) => console.log('voice recording error', error));\r\n  };\r\n\r\n  const handlePermissions = (record) => {\r\n    // adaptive for all browsers\r\n    navigator.getUserMedia = (\r\n      navigator.getUserMedia\r\n      || navigator.webkitGetUserMedia\r\n      || navigator.mozGetUserMedia\r\n      || navigator.msGetUserMedia\r\n    );\r\n\r\n    // set permissions\r\n    navigator.getUserMedia({ audio: true },\r\n      (stream) => {\r\n        console.log('record', record);\r\n        if (record) {\r\n          console.log('Permission Granted');\r\n          setIsBlocked(false);\r\n        } else {\r\n          stream.getAudioTracks().forEach(track => {\r\n            track.stop();\r\n          })\r\n          // setIsBlocked(true);\r\n        }\r\n      },\r\n      () => {\r\n        console.log('Permission Denied');\r\n        setIsBlocked(true);\r\n      },\r\n    );\r\n\r\n    // off mic after voice recorded\r\n    // document.querySelectorAll('audio').forEach(item => {\r\n    //   console.log(item.srcObject);\r\n    //   if (!item.srcObject) return;\r\n    //   const tracks = item.srcObject.getTracks();\r\n    //   tracks.forEach(track => {\r\n    //     track.stop();\r\n    //   });\r\n    // });\r\n  }\r\n\r\n  // text messages\r\n\r\n  const sendMessage = (payload) => {\r\n    // audio messages\r\n    // firebase.storage()\r\n    //   .ref(`chats/${currentUser.id}/${payload.otherUserId}`)\r\n    //   .put(payload.messageInfo).then();\r\n    // firebase.database()\r\n    //   .ref(`chats/${payload.otherUserId}/${currentUser.id}`)\r\n    //   .push(payload.messageInfo);\r\n\r\n    // апихнуть url на моменте пуша в массив\r\n\r\n    // send message to both of users\r\n    firebase.database()\r\n      .ref(`chats/${currentUser.id}/${payload.otherUserId}`)\r\n      .push(payload.messageInfo);\r\n    firebase.database()\r\n      .ref(`chats/${payload.otherUserId}/${currentUser.id}`)\r\n      .push(payload.messageInfo);\r\n  }\r\n\r\n  const getMessages = (otherUserId) => {\r\n    // get messages from db\r\n    const newMessages = [];\r\n    messagesRef = firebase.database().ref(`chats/${currentUser.id}/${otherUserId}`);\r\n    // audioMessagesRef = firebase.storage().ref(`chats/${currentUser.id}/${otherUserId}`);\r\n\r\n    // audioMessagesRef.getMetadata().then(metadata => {\r\n    //   console.log(metadata);\r\n    // }).catch(error => {\r\n    //   console.log('metadata error', error);\r\n    // })\r\n\r\n    messagesRef.on('child_added', snapshot => {\r\n      let messageDetails = snapshot.val();\r\n      let messageId = snapshot.key;\r\n\r\n      newMessages.push({\r\n        messageDetails,\r\n        messageId\r\n      })\r\n\r\n      return Promise.all(newMessages).then(() => {\r\n        setMessages(() => {\r\n          setTimeout(() => setMessages(newMessages));\r\n        });\r\n      })\r\n    })\r\n  }\r\n\r\n  const stopGettingMessages = () => {\r\n    // stop getting messages then url changes\r\n    if (messagesRef) {\r\n      messagesRef.off('child_added')\r\n      setMessages([]);\r\n    }\r\n  }\r\n\r\n  const sendMessageHandler = (payload) => {\r\n    if (payload.message.current.value.trim().length <= 0 && !payload.showVoiceRecorder) return;\r\n    // set date of message\r\n    const createdAt = new Date();\r\n    const hours = createdAt.getHours()\r\n    const minutesStr = createdAt.getMinutes().toString()\r\n    const minutes = 2 >= minutesStr.length\r\n      ? Array.apply(null, { length: 2 - minutesStr.length + 1 }).join(\"0\") + minutesStr\r\n      : minutesStr.substring(0, 2);\r\n    const months = [\r\n      { string: \"January\", number: 1 },\r\n      { string: \"February\", number: 2 },\r\n      { string: \"March\", number: 3 },\r\n      { string: \"April\", number: 4 },\r\n      { string: \"May\", number: 5 },\r\n      { string: \"June\", number: 6 },\r\n      { string: \"July\", number: 7 },\r\n      { string: \"August\", number: 8 },\r\n      { string: \"September\", number: 9 },\r\n      { string: \"October\", number: 10 },\r\n      { string: \"November\", number: 11 },\r\n      { string: \"December\", number: 12 }\r\n    ];\r\n    const time = {\r\n      date: {\r\n        day: createdAt.getDate(),\r\n        month: months[createdAt.getMonth()],\r\n        year: createdAt.getFullYear()\r\n      },\r\n      hours,\r\n      minutes,\r\n    }\r\n\r\n    // set type of message\r\n    let messageType;\r\n    if (payload.showVoiceRecorder) {\r\n      messageType = 'voice';\r\n      // надо придумать voiceId какой то чтобы потом тягать по нему файл из базы данных с голосовыми\r\n      // send voice messages\r\n      firebase.storage().ref(`chats/${currentUser.id}/${payload.otherUserId}/${payload.uniqId}`).getDownloadURL().then(url => {\r\n        sendMessage({\r\n          otherUserId: payload.otherUserId,\r\n          messageInfo: {\r\n            from: {\r\n              name: currentUser.name,\r\n              id: currentUser.id\r\n            },\r\n            time,\r\n            type: messageType,\r\n            url\r\n          }\r\n        })\r\n      });\r\n    } else {\r\n      // send text messages\r\n      messageType = 'text';\r\n      sendMessage({\r\n        otherUserId: payload.otherUserId,\r\n        messageInfo: {\r\n          image: '',\r\n          message: payload.message.current.value,\r\n          from: {\r\n            name: currentUser.name,\r\n            id: currentUser.id\r\n          },\r\n          time,\r\n          type: messageType\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  const value = {\r\n    // state\r\n    messages,\r\n    isRecording,\r\n    isBlocked,\r\n    // text messages actions\r\n    sendMessage,\r\n    getMessages,\r\n    stopGettingMessages,\r\n    sendMessageHandler,\r\n    // voice messages actions\r\n    start,\r\n    stop,\r\n    handlePermissions\r\n  }\r\n\r\n  return (\r\n    <MessagesContext.Provider value={value}>\r\n      {children}\r\n    </MessagesContext.Provider>\r\n  )\r\n}\r\n","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\contexts\\GlobalPopupContext.js",[],"C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\components\\GlobalPopup\\GlobalPopup.js",[],"C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\components\\StartListenServer\\StartListenServer.js",["152"],"import React, { useEffect, useState } from \"react\";\r\nimport { useVideo } from \"../../contexts/VideoContext\";\r\nimport { useAuth } from \"../../contexts/AuthContext\";\r\n\r\nconst StartListenServer = () => {\r\n  const { startListen } = useVideo();\r\n  const [ loading, setLoading ] = useState(true);\r\n  const { currentUser } = useAuth();\r\n\r\n  useEffect(() => {\r\n    currentUser ? setLoading(false) : setLoading(true);\r\n  }, [ currentUser ]);\r\n\r\n  useEffect(() => {\r\n    if (!loading) {\r\n      startListen();\r\n      console.log('listen')\r\n    }\r\n  }, [loading]);\r\n\r\n  return (\r\n    <></>\r\n  );\r\n}\r\n\r\nexport default StartListenServer;\r\n","C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\pages\\UpdateProfilePage\\UpdateProfilePage.js",[],"C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\pages\\ChatPage\\ChatPage.js",["153","154"],"C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\pages\\VideoChatPage\\VideoChatPage.js",["155","156","157","158","159"],"C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\pages\\ForgotPasswordPage\\ForgotPasswordPage.js",[],"C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\pages\\NewsPage\\NewsPage.js",[],"C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\pages\\LoginPage\\LoginPage.js",[],"C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\pages\\SignupPage\\SignupPage.js",[],"C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\components\\AudioMessage\\AudioMessage.js",["160","161","162","163","164","165"],"import React, { useEffect, useState } from 'react';\r\nimport MicRecorder from 'mic-recorder-to-mp3';\r\n\r\nconst Mp3Recorder = new MicRecorder({ bitRate: 128 });\r\n\r\nconst AudioMessage = () => {\r\n  // state\r\n  const [ isRecording, setIsRecording ] = useState(false);\r\n  const [ blobURL, setBlobURL ] = useState('');\r\n  const [ isBlocked, setIsBlocked ] = useState(false);\r\n  // other\r\n  // const start = () => {\r\n  //   if (isBlocked) {\r\n  //     console.log('Permission Denied');\r\n  //   } else {\r\n  //     Mp3Recorder\r\n  //       .start()\r\n  //       .then(() => {\r\n  //         setIsRecording(true)\r\n  //       }).catch((e) => console.error(e));\r\n  //   }\r\n  // };\r\n  //\r\n  // const stop = () => {\r\n  //   Mp3Recorder\r\n  //     .stop()\r\n  //     .getMp3()\r\n  //     .then(([ buffer, blob ]) => {\r\n  //       const blobURL = URL.createObjectURL(blob)\r\n  //       console.log(blobURL);\r\n  //       setBlobURL(blobURL);\r\n  //       setIsRecording(false);\r\n  //     }).catch((e) => console.log(e));\r\n  // };\r\n\r\n  // const handlePermissions = () => {\r\n  //   navigator.getUserMedia({ audio: true },\r\n  //     () => {\r\n  //       console.log('Permission Granted');\r\n  //       setIsBlocked(false);\r\n  //     },\r\n  //     () => {\r\n  //       console.log('Permission Denied');\r\n  //       setIsBlocked(true);\r\n  //     },\r\n  //   );\r\n  // }\r\n\r\n  useEffect(() => {\r\n    // handlePermissions();\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"App\">\r\n      <header className=\"App-header\">\r\n        <audio src={blobURL} controls=\"controls\"/>\r\n      </header>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default AudioMessage;\r\n",["166","167"],"C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\contexts\\ThemeContext.js",[],"C:\\Users\\Савва\\Desktop\\prog\\react\\simple\\simple-frontend\\src\\components\\SwitchTheme\\SwitchTheme.js",[],{"ruleId":"168","replacedBy":"169"},{"ruleId":"170","replacedBy":"171"},{"ruleId":"172","severity":1,"message":"173","line":3,"column":8,"nodeType":"174","messageId":"175","endLine":3,"endColumn":13},{"ruleId":"172","severity":1,"message":"176","line":7,"column":10,"nodeType":"174","messageId":"175","endLine":7,"endColumn":18},{"ruleId":"172","severity":1,"message":"177","line":14,"column":11,"nodeType":"174","messageId":"175","endLine":14,"endColumn":17},{"ruleId":"172","severity":1,"message":"178","line":18,"column":24,"nodeType":"174","messageId":"175","endLine":18,"endColumn":32},{"ruleId":"179","severity":1,"message":"180","line":12,"column":6,"nodeType":"181","endLine":12,"endColumn":21,"suggestions":"182"},{"ruleId":"168","replacedBy":"183"},{"ruleId":"170","replacedBy":"184"},{"ruleId":"172","severity":1,"message":"185","line":1,"column":29,"nodeType":"174","messageId":"175","endLine":1,"endColumn":38},{"ruleId":"172","severity":1,"message":"186","line":2,"column":8,"nodeType":"174","messageId":"175","endLine":2,"endColumn":16},{"ruleId":"172","severity":1,"message":"187","line":18,"column":20,"nodeType":"174","messageId":"175","endLine":18,"endColumn":30},{"ruleId":"172","severity":1,"message":"185","line":1,"column":29,"nodeType":"174","messageId":"175","endLine":1,"endColumn":38},{"ruleId":"179","severity":1,"message":"188","line":19,"column":6,"nodeType":"181","endLine":19,"endColumn":15,"suggestions":"189"},{"ruleId":"172","severity":1,"message":"190","line":23,"column":5,"nodeType":"174","messageId":"175","endLine":23,"endColumn":9},{"ruleId":"179","severity":1,"message":"191","line":44,"column":6,"nodeType":"181","endLine":44,"endColumn":21,"suggestions":"192"},{"ruleId":"172","severity":1,"message":"193","line":2,"column":8,"nodeType":"174","messageId":"175","endLine":2,"endColumn":10},{"ruleId":"172","severity":1,"message":"194","line":3,"column":8,"nodeType":"174","messageId":"175","endLine":3,"endColumn":12},{"ruleId":"172","severity":1,"message":"195","line":6,"column":22,"nodeType":"174","messageId":"175","endLine":6,"endColumn":33},{"ruleId":"172","severity":1,"message":"196","line":19,"column":11,"nodeType":"174","messageId":"175","endLine":19,"endColumn":21},{"ruleId":"179","severity":1,"message":"197","line":71,"column":6,"nodeType":"181","endLine":71,"endColumn":21,"suggestions":"198"},{"ruleId":"172","severity":1,"message":"199","line":4,"column":7,"nodeType":"174","messageId":"175","endLine":4,"endColumn":18},{"ruleId":"172","severity":1,"message":"200","line":8,"column":11,"nodeType":"174","messageId":"175","endLine":8,"endColumn":22},{"ruleId":"172","severity":1,"message":"201","line":8,"column":24,"nodeType":"174","messageId":"175","endLine":8,"endColumn":38},{"ruleId":"172","severity":1,"message":"202","line":9,"column":20,"nodeType":"174","messageId":"175","endLine":9,"endColumn":30},{"ruleId":"172","severity":1,"message":"203","line":10,"column":11,"nodeType":"174","messageId":"175","endLine":10,"endColumn":20},{"ruleId":"172","severity":1,"message":"204","line":10,"column":22,"nodeType":"174","messageId":"175","endLine":10,"endColumn":34},{"ruleId":"168","replacedBy":"205"},{"ruleId":"170","replacedBy":"206"},"no-native-reassign",["207"],"no-negated-in-lhs",["208"],"no-unused-vars","'Alert' is defined but never used.","Identifier","unusedVar","'useTheme' is defined but never used.","'errors' is assigned a value but never used.","'allUsers' is assigned a value but never used.","react-hooks/exhaustive-deps","React Hook useEffect has a missing dependency: 'fetchUser'. Either include it or remove the dependency array.","ArrayExpression",["209"],["207"],["208"],"'useEffect' is defined but never used.","'firebase' is defined but never used.","'setLoading' is assigned a value but never used.","React Hook useEffect has a missing dependency: 'startListen'. Either include it or remove the dependency array.",["210"],"'test' is assigned a value but never used.","React Hook useEffect has a missing dependency: 'getMessages'. Either include it or remove the dependency array.",["211"],"'io' is defined but never used.","'Peer' is defined but never used.","'useLocation' is defined but never used.","'addMessage' is assigned a value but never used.","React Hook useEffect has a missing dependency: 'startVideo'. Either include it or remove the dependency array.",["212"],"'Mp3Recorder' is assigned a value but never used.","'isRecording' is assigned a value but never used.","'setIsRecording' is assigned a value but never used.","'setBlobURL' is assigned a value but never used.","'isBlocked' is assigned a value but never used.","'setIsBlocked' is assigned a value but never used.",["207"],["208"],"no-global-assign","no-unsafe-negation",{"desc":"213","fix":"214"},{"desc":"215","fix":"216"},{"desc":"217","fix":"218"},{"desc":"219","fix":"220"},"Update the dependencies array to be: [currentUser, fetchUser]",{"range":"221","text":"222"},"Update the dependencies array to be: [loading, startListen]",{"range":"223","text":"224"},"Update the dependencies array to be: [getMessages, otherUserId]",{"range":"225","text":"226"},"Update the dependencies array to be: [currentUser, startVideo]",{"range":"227","text":"228"},[313,328],"[currentUser, fetchUser]",[541,550],"[loading, startListen]",[1413,1428],"[getMessages, otherUserId]",[1704,1719],"[currentUser, startVideo]"]